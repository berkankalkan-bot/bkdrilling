name: Deploy to Güzelhosting

on:
  push:
    branches:
      - main  # Ana branch'e push olduğunda çalışır
  workflow_dispatch:  # Manuel olarak da çalıştırabilirsiniz

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build Next.js static site
        run: npm run build

      - name: Install Node FTP Deploy
        run: npm install -g ftp-deploy

      - name: Create FTP Deploy Config
        run: |
          cat > ftp-config.json << 'EOF'
          {
            "host": "${{ secrets.FTP_SERVER }}",
            "port": 21,
            "user": "${{ secrets.FTP_USERNAME }}",
            "password": "${{ secrets.FTP_PASSWORD }}",
            "localRoot": "./out",
            "remoteRoot": "/public_html/",
            "include": ["*", "**/*"],
            "deleteRemote": false,
            "forcePasv": true,
            "sftp": false
          }
          EOF

      - name: Deploy to FTP
        run: |
          npx ftp-deploy --config ftp-config.json --verbose
